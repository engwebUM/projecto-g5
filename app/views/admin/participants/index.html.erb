<div class="List">
  <div class="row">
    <h1 class="title">Listing Participants</h1>
    <div class="column">
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Checkin Done?</th>
            <th>
              <div>
                <div>
                  <label>
                    <input type="checkbox" onClick="toggle(this)"/>Credentials<br/>
                  </label>
                  <a href="#" alt="Generate Credentials" title="Generate Credentials" type="button" class="btn btn-default icon-generate-creadentials" onclick="generateCredentials()"></a>
                </div>
              </div>
            </th>
            <th>Kit deliveried?</th>
            <th>Paid?</th>
            <th>Credentials created?</th>
            <th colspan="3"></th>
          </tr>
        </thead>
        <tbody>
          <% @participants.each do |participant| %>
            <tr>
              <td><%= participant.name %></td>
              <td><%= participant.email %></td>
              <td>
                <% if participant.checkin? %>
                  <div>
                    <button type="button" class="btn btn-default" disabled="disabled">Checkin</button>
                  </div>
                <% else %>
                  <div>
                    <%= link_to "Checkin", {:action => "update_checkin", :id => participant.id, :remote => true}, class: "btn btn-info active", id: 'button_checkin', :onclick => 'update_button_checkin(this)' %>
                  </div>
                <% end %>
              </td>
              <td>
                <div>
                  <label>
                    <input type="checkbox" name="credential" onclick="dataSave(this, '<%= participant.name %>', '<%= participant.email %>')"><br/>
                  </label>
                </div>  
              </td>
              <td><input type="checkbox" <%= (participant.kit) ? "checked" : "" %>></td>
              
              <!--<td><input type="checkbox" <%= (participant.paid) ? "checked" : "" %>></td>-->
              <td>
                <% if participant.paid? %>
                  <div>
                    <button type="button" class="btn btn-default" disabled="disabled">Paid</button>
                  </div>
                <% else %>
                  <div>
                    <%= link_to "Paid", {:action => "update_paid", :id => participant.id, :remote => true}, class: "btn btn-info active", id: 'button_paid', :onclick => 'update_button_paid(this)' %>
                  </div>
                <% end %>
              </td>


              <td><input type="checkbox" <%= (participant.credentials) ? "checked" : "" %>></td>
              <td><%= link_to 'Show', admin_participant_path(participant) %></td>
              <td><%= link_to 'Edit', edit_admin_participant_path(participant) %></td>
              <td><%= link_to 'Destroy', admin_participant_path(participant), method: :delete, data: { confirm: 'Are you sure?' } %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <p>
        <div>
          <div>
            <%= link_to 'New Participant', new_admin_participant_path %>
          </div>

          <p id="demo"></p>
          
        </div>
      </p>
    </div>
  </div>
</div>




<script language="JavaScript">

function toggle(source) {
  checkboxes = document.getElementsByName('credential');
  var i = 0;
  <% @participants.each do |participant| %>
    checkboxes[i].checked = source.checked;
    var info = '<%= participant.name %>' + "&" + '<%= participant.email %>';
    checkboxes[i].value = info;
    i++;
  <% end %>
}

function dataSave(checkbox, name, email) {
  var info = name + "&" + email;
  checkbox.value = info;
}

function generateCredentials() {
  var participants = [];
  var i;
  checkboxes = document.getElementsByName('credential');
  for(var i=0, n=checkboxes.length;i<n;i++) {
    if (checkboxes[i].checked) {
      participants.push(checkboxes[i].value);
    }
  }

  var text = "<div>";

  for (i=0;i<participants.length;i++) {
    var data = participants[i].split("&");
    text += "<div class='credential'><div class='double'><p class='nome'>"+data[0]+"</p><p class='mail'>Email: "+data[1]+"</p></div></div>";
  }
  text += "</div>";
  
  document.getElementById("demo").innerHTML = text;
}

function update_button_checkin(el) {
  el.className = "btn btn-default";
}

function update_button_paid(el) {
  el.className = "btn btn-default";
}
</script>
